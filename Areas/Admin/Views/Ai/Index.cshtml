@{
    ViewData["Title"] = "AI trợ lý";
    Layout = "_AdminLayout";
}
<style>
.ai-card{max-width:880px;margin-inline:auto;border:1px solid #e5e7eb;border-radius:14px;padding:16px;background:#fff;box-shadow:0 8px 28px rgba(15,23,42,.06)}
.ai-input{display:flex;gap:8px}
.ai-input input{flex:1;border-radius:12px}
.ai-res .item{border:1px solid #eef2f7;border-radius:12px;padding:12px;margin-top:10px}
.ai-res .item .title{font-weight:700}
.ai-score{font-size:.85rem;color:#64748b}
</style>

<div class="container-xxl py-4">
  <div class="ai-card">
    <div class="ai-input mb-2">
      <input id="q" class="form-control" placeholder="Hỏi tôi điều gì đó..." />
      <button id="btn" class="btn btn-primary">Tìm</button>
    </div>
    <div id="res" class="ai-res"></div>
  </div>
</div>

<script>
const btn = document.getElementById('btn');
const q   = document.getElementById('q');
const res = document.getElementById('res');

async function run(){
  try {
    const form = new FormData();
    form.append('q', q.value);
    const r = await fetch('@Url.Action("Search","Ai", new { area="Admin" })', { method:'POST', body:form });
    
    if (!r.ok) {
      throw new Error(`HTTP error! status: ${r.status}`);
    }
    
    const data = await r.json();
    res.innerHTML = '';
    
    if (data.error) {
      res.innerHTML = `<div class="alert alert-danger">${data.error}</div>`;
      return;
    }
    
    if(!data.results || !data.results.length){
      res.innerHTML = '<div class="text-muted">Không tìm thấy.</div>'; 
      return;
    }
    
    for(const it of data.results){
      const div = document.createElement('div');
      div.className = 'item';
      div.innerHTML = `
        <div class="title">${it.title ?? '(Không tiêu đề)'}</div>
        <div class="ai-score">Độ tương đồng: ${(it.score*100).toFixed(1)}%</div>
        ${it.snippet ? `<div class="mt-1">${it.snippet}</div>` : ''}
        ${it.url ? `<a class="btn btn-sm btn-outline-primary mt-2" href="${it.url}" target="_blank">Mở nguồn</a>` : ''}
      `;
      res.appendChild(div);
    }
  } catch (error) {
    res.innerHTML = `<div class="alert alert-danger">Lỗi: ${error.message}</div>`;
  }
}
btn.addEventListener('click', run);
q.addEventListener('keydown', e => { if(e.key==='Enter') run(); });
</script>
