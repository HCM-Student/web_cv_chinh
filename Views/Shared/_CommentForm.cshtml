@model WEB_CV.Models.BinhLuan

<div class="comment-form-section">
    <h5 class="form-title">
        <i class="fas fa-edit me-2"></i>
        Viết bình luận
    </h5>
    
    @if (TempData["CommentSuccess"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show">
            @TempData["CommentSuccess"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }
    
    @if (TempData["CommentError"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show">
            @TempData["CommentError"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    <form asp-action="Create" asp-controller="BinhLuan" method="post" class="comment-form" id="commentForm">
        @Html.AntiForgeryToken()
        <input type="hidden" asp-for="BaiVietId" />
        <input type="hidden" id="ParentId" name="ParentId" value="" />
        
        @if (User.Identity?.IsAuthenticated == true)
        {
            <div class="user-info">
                <i class="fas fa-user-check me-2"></i>
                Bạn đang bình luận với tư cách: <strong>@User.Identity.Name</strong>
            </div>
        }
        else
        {
            <div class="alert alert-info mb-3">
                <i class="fas fa-info-circle me-2"></i>
                <strong>Lưu ý:</strong> Bình luận của bạn sẽ được kiểm duyệt trước khi hiển thị công khai.
            </div>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label asp-for="HoTen" class="form-label">Họ tên *</label>
                    <input asp-for="HoTen" class="form-control" placeholder="Nhập họ tên của bạn" required />
                    <span asp-validation-for="HoTen" class="text-danger"></span>
                </div>
                <div class="col-md-6 mb-3">
                    <label asp-for="Email" class="form-label">Email *</label>
                    <input asp-for="Email" type="email" class="form-control" placeholder="Nhập email của bạn" required />
                    <span asp-validation-for="Email" class="text-danger"></span>
                </div>
            </div>
        }
        
        <div class="mb-3">
            <label asp-for="NoiDung" class="form-label">Nội dung bình luận *</label>
            <textarea asp-for="NoiDung" class="form-control" rows="4" 
                      placeholder="Viết bình luận của bạn..." required></textarea>
            <span asp-validation-for="NoiDung" class="text-danger"></span>
            <div class="form-text">Tối đa 1000 ký tự</div>
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-paper-plane me-2"></i>
                Gửi bình luận
            </button>
            <button type="reset" class="btn btn-outline-secondary">
                <i class="fas fa-undo me-2"></i>
                Làm mới
            </button>
        </div>
    </form>
</div>

<style>
.comment-form-section {
    background: white;
    padding: 2rem;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    border: 1px solid #e9ecef;
    margin-bottom: 2rem;
}

.form-title {
    color: #2c3e50;
    font-weight: 700;
    margin-bottom: 1.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid #4f46e5;
    display: flex;
    align-items: center;
}

.user-info {
    background: linear-gradient(135deg, rgba(79, 70, 229, 0.1), rgba(6, 182, 212, 0.1));
    padding: 1rem;
    border-radius: 10px;
    margin-bottom: 1.5rem;
    color: #2c3e50;
    font-weight: 500;
    border-left: 4px solid #4f46e5;
}

.comment-form {
    margin-top: 1rem;
}

.form-label {
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 0.5rem;
}

.form-control {
    border: 2px solid #e5e7eb;
    border-radius: 10px;
    padding: 0.75rem 1rem;
    transition: all 0.3s ease;
    font-size: 0.95rem;
}

.form-control:focus {
    border-color: #4f46e5;
    box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
    outline: none;
}

.form-control::placeholder {
    color: #adb5bd;
}

.form-text {
    font-size: 0.85rem;
    color: #6c757d;
    margin-top: 0.25rem;
}

.form-actions {
    display: flex;
    gap: 1rem;
    align-items: center;
    margin-top: 1.5rem;
}

.btn {
    padding: 0.75rem 1.5rem;
    border-radius: 10px;
    font-weight: 600;
    transition: all 0.3s ease;
    border: none;
    display: inline-flex;
    align-items: center;
    text-decoration: none;
}

.btn-primary {
    background: linear-gradient(135deg, #4f46e5, #06b6d4);
    color: white;
    box-shadow: 0 4px 15px rgba(79, 70, 229, 0.3);
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(79, 70, 229, 0.4);
    color: white;
}

.btn-outline-secondary {
    background: transparent;
    color: #6c757d;
    border: 2px solid #e5e7eb;
}

.btn-outline-secondary:hover {
    background: #f8f9fa;
    border-color: #adb5bd;
    color: #495057;
}

.text-danger {
    color: #dc3545;
    font-size: 0.85rem;
    margin-top: 0.25rem;
    display: block;
}

/* Responsive */
@@media (max-width: 768px) {
    .comment-form-section {
        padding: 1.5rem;
    }
    
    .form-actions {
        flex-direction: column;
        gap: 0.75rem;
    }
    
    .btn {
        width: 100%;
        justify-content: center;
    }
}
</style>

<script>
// Handle reply functionality
document.addEventListener('DOMContentLoaded', function() {
    const commentForm = document.getElementById('commentForm');
    const parentIdField = document.getElementById('ParentId');
    const textarea = commentForm.querySelector('textarea');
    const formTitle = document.querySelector('.form-title');
    
    // Listen for reply events
    document.addEventListener('replyToComment', function(event) {
        const { commentId, authorName } = event.detail;
        
        // Set parent ID
        parentIdField.value = commentId;
        
        // Update form title
        formTitle.innerHTML = '<i class="fas fa-reply me-2"></i>Trả lời @@' + authorName;
        
        // Focus on textarea
        textarea.focus();
        textarea.value = '@@' + authorName + ' ';
        
        // Scroll to form
        commentForm.scrollIntoView({ behavior: 'smooth', block: 'center' });
    });
    
    // Reset form when submitting new comment (not reply)
    commentForm.addEventListener('submit', function() {
        if (!parentIdField.value) {
            // This is a new comment, not a reply
            formTitle.innerHTML = '<i class="fas fa-edit me-2"></i>Viết bình luận';
        }
    });
    
    // Reset form when clicking reset button
    const resetBtn = commentForm.querySelector('button[type="reset"]');
    if (resetBtn) {
        resetBtn.addEventListener('click', function() {
            parentIdField.value = '';
            formTitle.innerHTML = '<i class="fas fa-edit me-2"></i>Viết bình luận';
        });
    }
});
</script>
